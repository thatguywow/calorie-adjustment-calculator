<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Calorie Adjustment Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Raleway:wght@800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
    	* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Poppins', sans-serif;
}

body {
    background: #2d2d2d; /* Dark charcoal background */
    color: #e0e0e0; /* Light text for contrast */
    min-height: 100vh;
    padding: 40px 20px;
    display: flex;
    justify-content: center;
    align-items: flex-start;
}

.container {
    background-color: #1f1f1f; /* Slightly lighter charcoal for container */
    border-radius: 12px;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3); /* Subtle shadow for depth */
    width: 100%;
    max-width: 600px;
    overflow: hidden; /* Prevent white edges */
}

.logo-header {
    background: linear-gradient(135deg, #4b5bd1 0%, #2a2e6b 100%); /* Smooth blue-to-dark gradient */
    padding: 30px 20px;
    text-align: center;
    border-top-left-radius: 12px;
    border-top-right-radius: 12px;
    position: relative;
    overflow: hidden;
}

.logo-header::before {
    content: "";
    position: absolute;
    top: -10%;
    left: -10%;
    width: 120%;
    height: 120%;
    background: radial-gradient(circle at 40% 40%, rgba(255, 255, 255, 0.05) 0%, rgba(255, 255, 255, 0) 70%);
    z-index: 0; /* Behind content */
}

.logo {
    font-family: 'Raleway', sans-serif;
    font-size: 2.5rem;
    font-weight: 800;
    color: transparent;
    text-transform: uppercase;
    letter-spacing: 1.2px;
    margin-bottom: 12px;
    background: linear-gradient(to right, #facc15 0%, #f97316 100%); /* Smooth yellow-orange gradient */
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    position: relative;
    z-index: 1; /* Above pseudo-element */
}

.logo-subtitle {
    color: rgba(255, 255, 255, 0.85);
    font-size: 1rem;
    max-width: 85%;
    margin: 0 auto;
    line-height: 1.6;
    font-weight: 400;
    position: relative;
    z-index: 1;
}

.content {
    padding: 40px 30px;
}

.info-box {
    background: #2a2a2a; /* Darker background for info box */
    border-radius: 10px;
    padding: 25px;
    margin-bottom: 35px;
    border-left: 3px solid #4b5bd1; /* Subtle blue accent */
}

.info-box h3 {
    color: #a3bffa; /* Light blue for headings */
    margin-bottom: 15px;
    font-size: 1.3rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 10px;
}

.info-box p,
.info-box ul {
    margin-bottom: 15px;
    color: #b0b0b0; /* Light gray for text */
    line-height: 1.9;
    font-size: 0.95rem;
}

.form-group {
    margin-bottom: 30px;
}

.form-group label {
    display: block;
    margin-bottom: 10px;
    font-weight: 500;
    color: #d1d1d1; /* Light gray for labels */
    font-size: 1rem;
    display: flex;
    align-items: center;
    gap: 8px;
}

select,
input {
    width: 100%;
    padding: 14px;
    border: 1px solid #3d3d3d; /* Darker border */
    border-radius: 8px;
    font-size: 1rem;
    background-color: #252525; /* Dark input background */
    transition: all 0.2s ease;
    color: #e0e0e0;
}

select:focus,
input:focus {
    border-color: #4b5bd1;
    outline: none;
    box-shadow: 0 0 0 3px rgba(75, 91, 209, 0.3);
}

.buttons {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-top: 25px;
}

button {
    padding: 14px;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

#calculateBtn {
    background: linear-gradient(to right, #22c55e 0%, #16a34a 100%); /* Smooth green gradient */
    color: white;
}

#resetBtn {
    background: linear-gradient(to right, #ef4444 0%, #dc2626 100%); /* Smooth red gradient */
    color: white;
}

button:hover {
    transform: scale(1.03);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

button:active {
    transform: scale(1);
}

.results {
    background: #2a2a2a;
    border-radius: 10px;
    padding: 30px;
    margin-top: 35px;
    display: none;
    border: 1px solid #3d3d3d;
}

.results h2 {
    text-align: center;
    margin-bottom: 25px;
    color: #a3bffa;
    font-size: 1.6rem;
    font-weight: 600;
    display: flex;
    justify-content: center;
    gap: 10px;
}

.result-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 15px;
}

.result-item {
    display: flex;
    justify-content: space-between;
    padding: 15px;
    border-radius: 8px;
    background: #252525;
    transition: transform 0.2s ease;
}

.result-item:hover {
    transform: translateY(-2px);
}

.result-label {
    font-weight: 500;
    color: #d1d1d1;
    display: flex;
    align-items: center;
    gap: 8px;
}

.result-value {
    font-weight: 600;
    text-align: right;
    font-size: 1.05rem;
}

.positive {
    color: #22c55e;
}

.negative {
    color: #ef4444;
}

.action-box {
    padding: 20px;
    border-radius: 8px;
    margin-top: 25px;
    text-align: center;
    font-weight: 500;
    font-size: 1.1rem;
    display: none;
}

.increase-action {
    background: #1f2f23; /* Dark green tint */
    color: #22c55e;
    border: 1px solid #4ade80;
}

.decrease-action {
    background: #2f1f1f; /* Dark red tint */
    color: #ef4444;
    border: 1px solid #f87171;
}

.maintenance-rate {
    margin-top: 20px;
    display: flex;
    gap: 12px;
    align-items: center;
    justify-content: center;
    flex-wrap: wrap;
}

.maintenance-rate input {
    width: 130px;
    padding: 10px;
    border-radius: 8px;
}

.maintenance-desc {
    margin-top: 15px;
    text-align: center;
    color: #b0b0b0;
    font-size: 0.9rem;
}

.calorie-disclaimer {
    margin-top: 20px;
    font-size: 0.85rem;
    color: #f87171; /* Red for warning */
    background: #2f1f1f;
    border-left: 3px solid #dc2626;
    padding: 12px 15px;
    border-radius: 8px;
    line-height: 1.5;
    display: none;
}

footer {
    text-align: center;
    padding: 20px;
    color: #6b7280;
    font-size: 0.9rem;
    border-top: 1px solid #3d3d3d;
    background-color: #1f1f1f;
}

@media (max-width: 480px) {
    body {
        padding: 20px;
    }
    .container {
        border-radius: 10px;
    }
    .logo-header {
        padding: 20px 15px;
    }
    .logo {
        font-size: 2rem;
    }
    .content {
        padding: 25px 15px;
    }
    button {
        padding: 12px;
        font-size: 0.95rem;
    }
    .maintenance-rate input {
        width: 120px;
    }
    .calorie-disclaimer {
        font-size: 0.8rem;
        padding: 10px;
    }
}
    </style>
</head>
<body>
    <div class="container">
        <div class="logo-header">
            <div class="logo">Calorie Adjustment Calculator</div>
            <p class="logo-subtitle">Precisely adjust your calorie intake based on weekly weight trends</p>
        </div>

        <div class="content">
            <div class="info-box">
                <h3><i class="fas fa-info-circle"></i> How to Use This Calculator</h3>
                <p>This tool helps you adjust your daily calorie intake based on your actual weight change compared to your goal. Here's how to use it:</p>

                <h3><i class="fas fa-calculator"></i> Calculating Weekly Median Weight</h3>
                <ul>
                    <li>Weigh yourself at the same time each day for a week</li>
                    <li>Record all 7 weights (e.g. 75.2, 75.0, 74.8, 75.1, 75.3, 74.9, 75.0)</li>
                    <li>Sort the weights from lowest to highest</li>
                    <li>The median is the middle value (4th value in this example: 75.0 kg)</li>
                </ul>

                <h3><i class="fas fa-lightbulb"></i> Why This Calculator is Useful</h3>
                <p>By comparing weekly median weights, you eliminate daily fluctuations and get a true picture of your weight trend. The calculator then tells you how to adjust your calories to stay on track with your goals.</p>
            </div>

            <div class="form-group">
                <label for="goal"><i class="fas fa-bullseye"></i> Goal Type:</label>
                <select id="goal" onchange="toggleGoalField()" required>
                    <option value="" disabled selected>Select your goal</option>
                    <option value="loss">Weight Loss</option>
                    <option value="gain">Weight Gain</option>
                    <option value="maintenance">Weight Maintenance</option>
                </select>
            </div>

            <div class="form-group">
                <label for="prev_weight"><i class="fas fa-weight-scale"></i> Previous Weekly Median Weight (kg):</label>
                <input type="number" step="0.1" id="prev_weight" placeholder="e.g., 75.5">
            </div>

            <div class="form-group">
                <label for="curr_weight"><i class="fas fa-weight-scale"></i> Current Weekly Median Weight (kg):</label>
                <input type="number" step="0.1" id="curr_weight" placeholder="e.g., 74.8">
            </div>

            <div class="form-group goal-field" id="goalField">
                <label for="weekly_goal"><i class="fas fa-tachometer-alt"></i> Weekly Goal Amount (kg/week):</label>
                <input type="number" step="0.1" id="weekly_goal" placeholder="e.g., 0.5 (for loss/gain)">
            </div>

            <div class="form-group">
                <label for="calories"><i class="fas fa-fire"></i> Current Daily Calories:</label>
                <input type="number" id="calories" placeholder="e.g., 2000">
            </div>

            <div class="buttons">
                <button id="calculateBtn" type="button"><i class="fas fa-calculator"></i> Calculate Adjustment</button>
                <button id="resetBtn" type="button"><i class="fas fa-redo"></i> Reset Form</button>
            </div>

            <div class="results" id="resultsSection">
                <h2><i class="fas fa-chart-line"></i> Your Calorie Adjustment</h2>

                <div class="result-grid">
                    <div class="result-item">
                        <span class="result-label"><i class="fas fa-exchange-alt"></i> Daily Adjustment Needed:</span>
                        <span class="result-value" id="adjustment">-</span>
                    </div>

                    <div class="result-item">
                        <span class="result-label"><i class="fas fa-burn"></i> Current Calories:</span>
                        <span class="result-value" id="current_calories">-</span>
                    </div>

                    <div class="result-item">
                        <span class="result-label"><i class="fas fa-bullseye"></i> New Calorie Target:</span>
                        <span class="result-value" id="new_calories">-</span>
                    </div>
                </div>

                <!-- Maintenance rate UI (shown only for maintenance when relevant) -->
                <div id="maintenanceRateSection" style="display:none;">
                    <div class="maintenance-desc" id="maintenanceRateDesc"></div>
                    <div class="maintenance-rate">
                        <label for="maintenance_rate_input">Weekly rate (kg/week):</label>
                        <input type="number" step="0.05" id="maintenance_rate_input" />
                        <button id="applyRateBtn" type="button">Apply Rate</button>
                    </div>
                </div>

                <!-- Small safety disclaimer shown only when new_calories is low -->
                <div id="calorieDisclaimer" class="calorie-disclaimer" role="status" aria-live="polite">
                    <i class="fas fa-exclamation-triangle"></i>
                    Suggested daily calories are below the commonly recommended minimum (1200 kcal/day). Consider choosing a smaller weekly rate or consult a healthcare professional before making large changes.
                </div>

                <div class="action-box" id="actionBox">
                    <span id="actionText"></span>
                </div>
            </div>
        </div>

        <footer>
            <p>Calorie Adjustment Calculator &copy; <span id="year"></span> | Precision Nutrition Tool</p>
        </footer>
    </div>

    <script>
        // Constants
        const DAILY_FACTOR = 7700 / 7; // ~1100 kcal/day per 1 kg/week
        const MIN_SAFE_CALORIES = 1200; // threshold for showing the disclaimer

        // DOM Elements
        const goalSelect = document.getElementById('goal');
        const goalField = document.getElementById('goalField');
        const calculateBtn = document.getElementById('calculateBtn');
        const resetBtn = document.getElementById('resetBtn');
        const resultsSection = document.getElementById('resultsSection');
        const adjustmentEl = document.getElementById('adjustment');
        const currentCaloriesEl = document.getElementById('current_calories');
        const newCaloriesEl = document.getElementById('new_calories');
        const actionBox = document.getElementById('actionBox');
        const actionText = document.getElementById('actionText');

        const maintenanceRateSection = document.getElementById('maintenanceRateSection');
        const maintenanceRateDesc = document.getElementById('maintenanceRateDesc');
        const maintenanceRateInput = document.getElementById('maintenance_rate_input');
        const applyRateBtn = document.getElementById('applyRateBtn');

        const calorieDisclaimer = document.getElementById('calorieDisclaimer');

        // Set footer year automatically
        document.getElementById('year').textContent = new Date().getFullYear();

        // Toggle weekly goal field & label based on selection
        function toggleGoalField() {
            const goal = goalSelect.value;
            // weekly goal input only for loss/gain
            goalField.style.display = (goal === 'maintenance') ? 'none' : 'block';

            // update the label for the prev_weight field when maintenance is selected
            const prevLabel = document.querySelector('label[for="prev_weight"]');
            if (prevLabel) {
                const prevInput = document.getElementById('prev_weight');
                const currInput = document.getElementById('curr_weight');
                if (goal === 'maintenance') {
                    prevLabel.innerHTML = '<i class="fas fa-weight-scale"></i> Goal Maintenance Weight (kg):';
                    if (prevInput) prevInput.placeholder = 'e.g., 73.5';
                    if (currInput) currInput.placeholder = 'e.g., 74.0';
                } else {
                    prevLabel.innerHTML = '<i class="fas fa-weight-scale"></i> Previous Weekly Median Weight (kg):';
                    if (prevInput) prevInput.placeholder = 'e.g., 75.5';
                    if (currInput) currInput.placeholder = 'e.g., 74.8';
                }
            }
        }

        // Helper: check if element is fully visible in viewport considering header height
        function isElementFullyVisible(el, headerHeight = 0) {
            const rect = el.getBoundingClientRect();
            return (rect.top >= headerHeight) && (rect.bottom <= window.innerHeight);
        }

        // Show/hide disclaimer based on new calories
        function updateCalorieDisclaimer(newCalories) {
            if (typeof newCalories !== 'number' || isNaN(newCalories)) {
                calorieDisclaimer.style.display = 'none';
                return;
            }
            if (newCalories < MIN_SAFE_CALORIES) {
                calorieDisclaimer.style.display = 'block';
            } else {
                calorieDisclaimer.style.display = 'none';
            }
        }

        // Helper to format and display results after computing/clamping new_calories
        function displayResultsFromRaw(caloriesCurrent, rawNewCalories) {
            // clamp to non-negative
            const new_calories = Math.max(0, rawNewCalories);
            const displayedAdjustment = new_calories - caloriesCurrent; // actual change applied

            const sign = displayedAdjustment >= 0 ? '+' : '';
            adjustmentEl.textContent = `${sign}${Math.abs(displayedAdjustment).toFixed(0)} calories`;
            adjustmentEl.className = displayedAdjustment >= 0 ? 'result-value positive' : 'result-value negative';

            currentCaloriesEl.textContent = `${caloriesCurrent.toFixed(0)} calories`;
            newCaloriesEl.textContent = `${new_calories.toFixed(0)} calories`;

            // action text
            const action = displayedAdjustment >= 0 ?
                `INCREASE your daily intake by ${Math.abs(displayedAdjustment).toFixed(0)} calories` :
                `DECREASE your daily intake by ${Math.abs(displayedAdjustment).toFixed(0)} calories`;

            actionText.textContent = action;
            actionBox.className = displayedAdjustment >= 0 ? 'action-box increase-action' : 'action-box decrease-action';
            actionBox.style.display = 'block';

            // disclaimer
            updateCalorieDisclaimer(new_calories);
        }

        // Recompute results for maintenance when user adjusts rate
        function applyMaintenanceRateAndUpdate(currentCalories, goalWeight, currWeight) {
            const inputVal = parseFloat(maintenanceRateInput.value);
            if (isNaN(inputVal)) {
                alert('Please enter a valid weekly rate (kg/week).');
                return;
            }

            // rate sign indicates direction (positive -> gain, negative -> lose)
            const rate = inputVal;
            const rawAdjustmentKcal = rate * DAILY_FACTOR; // positive -> increase calories
            const rawNewCalories = currentCalories + rawAdjustmentKcal;

            // update description & results using clamped display helper
            maintenanceRateDesc.innerHTML = `Using <strong>${rate.toFixed(2)} kg/week</strong> → <strong>${Math.abs(rawAdjustmentKcal).toFixed(0)} kcal/day</strong> ${rate >= 0 ? 'surplus' : 'deficit'} to move toward ${goalWeight.toFixed(1)} kg.`;

            displayResultsFromRaw(currentCalories, rawNewCalories);
        }

        // Main calculation function
        function calculate() {
            try {
                // Get values
                const goal = goalSelect.value;
                const prev_weight_raw = document.getElementById('prev_weight').value;
                const prev_weight = parseFloat(prev_weight_raw);
                const curr_weight = parseFloat(document.getElementById('curr_weight').value);
                const calories = parseFloat(document.getElementById('calories').value);

                // Validate goal selection
                if (!goal) throw "Please select a goal type";

                // Basic validation
                if (isNaN(curr_weight)) throw "Please enter current weight";
                if (isNaN(calories)) throw "Please enter current calories";

                let rawNewCalories = calories; // raw (may be negative before clamping)

                if (goal !== 'maintenance') {
                    // loss or gain: prev_weight is previous weekly median
                    if (isNaN(prev_weight)) throw "Please enter previous weight";
                    // FIXED validation: check raw string and parsed value
                    const wgRaw = document.getElementById('weekly_goal').value;
                    if (wgRaw === '' || isNaN(parseFloat(wgRaw))) throw "Please enter weekly goal amount";
                    const weekly_goal = parseFloat(wgRaw);

                    let rawAdjustmentKcal = 0;
                    if (goal === 'loss') {
                        const actual_change = prev_weight - curr_weight;
                        rawAdjustmentKcal = (actual_change - weekly_goal) * DAILY_FACTOR;
                    } else if (goal === 'gain') {
                        const actual_change = curr_weight - prev_weight;
                        rawAdjustmentKcal = -1 * (actual_change - weekly_goal) * DAILY_FACTOR;
                    }

                    rawNewCalories = calories + rawAdjustmentKcal;

                    // update description/results using clamped helper
                    displayResultsFromRaw(calories, rawNewCalories);

                    // hide maintenance controls
                    maintenanceRateSection.style.display = 'none';
                } else {
                    // MAINTENANCE mode
                    // Here prev_weight is treated as "goal maintenance weight" (label changed earlier)
                    if (isNaN(prev_weight)) throw "Please enter a goal maintenance weight";

                    const goalWeight = prev_weight;
                    const diff = goalWeight - curr_weight; // + => need to gain, - => need to lose
                    const absDiff = Math.abs(diff);

                    // If near goal, just aim to hold steady (no large adjustments)
                    const NEAR_THRESHOLD = 0.05; // kg
                    if (absDiff <= NEAR_THRESHOLD) {
                        rawNewCalories = calories; // no change
                        // hide maintenance UI
                        maintenanceRateSection.style.display = 'none';
                        displayResultsFromRaw(calories, rawNewCalories);
                    } else {
                        // default safe weekly rate: 0.25 kg/week toward goal, but if remaining diff < 0.25 use the remaining diff
                        const DEFAULT_RATE_MAG = 0.25;
                        const defaultRate = (absDiff < DEFAULT_RATE_MAG) ? diff : Math.sign(diff) * DEFAULT_RATE_MAG;

                        // show maintenance rate UI with default value
                        maintenanceRateSection.style.display = 'block';
                        maintenanceRateInput.value = defaultRate.toFixed(2);

                        // compute adjustment from the default rate (rate * DAILY_FACTOR)
                        const rawAdjustmentKcal = defaultRate * DAILY_FACTOR; // positive -> increase calories to gain, negative -> decrease for loss
                        rawNewCalories = calories + rawAdjustmentKcal;

                        // update description using rawAdjustment for clarity
                        maintenanceRateDesc.innerHTML = `Default: <strong>${defaultRate.toFixed(2)} kg/week</strong> → <strong>${Math.abs(rawAdjustmentKcal).toFixed(0)} kcal/day</strong>. Adjust below and press Apply to update the numbers.`

                        displayResultsFromRaw(calories, rawNewCalories);
                    }
                }

                // Show results and smart scroll if needed
                resultsSection.style.display = 'block';
                const headerEl = document.querySelector('.logo-header');
                const headerHeight = headerEl ? headerEl.offsetHeight : 0;
                const rect = resultsSection.getBoundingClientRect();

                if (!isElementFullyVisible(resultsSection, headerHeight)) {
                    const gap = 12;
                    const targetScroll = window.scrollY + rect.top - headerHeight - gap;
                    window.scrollTo({ top: Math.max(0, targetScroll), behavior: 'smooth' });
                }

            } catch (error) {
                alert(error);
            }
        }

        // Reset form function
        function resetForm() {
            goalSelect.value = "";
            document.getElementById('prev_weight').value = '';
            document.getElementById('curr_weight').value = '';
            document.getElementById('weekly_goal').value = '';
            document.getElementById('calories').value = '';
            resultsSection.style.display = 'none';
            actionBox.style.display = 'none';
            maintenanceRateSection.style.display = 'none';
            calorieDisclaimer.style.display = 'none';
            toggleGoalField();
        }

        // Apply rate button: re-calc using the maintenance rate input (reads current calories and weights)
        applyRateBtn.addEventListener('click', function() {
            // ensure maintenance UI is visible
            if (maintenanceRateSection.style.display !== 'block') {
                alert('Maintenance rate is not available right now. Calculate first with Maintenance selected.');
                return;
            }

            // Read needed inputs; ensure maintenance mode
            if (goalSelect.value !== 'maintenance') return;
            const goalWeight = parseFloat(document.getElementById('prev_weight').value);
            const currWeight = parseFloat(document.getElementById('curr_weight').value);
            const currentCalories = parseFloat(document.getElementById('calories').value);

            if (isNaN(goalWeight) || isNaN(currWeight) || isNaN(currentCalories)) {
                alert('Please ensure Goal Weight, Current Weight and Current Calories are set before applying the rate.');
                return;
            }

            applyMaintenanceRateAndUpdate(currentCalories, goalWeight, currWeight);
        });

        // Event Listeners
        calculateBtn.addEventListener('click', calculate);
        resetBtn.addEventListener('click', resetForm);

        // Initialize placeholders / UI
        toggleGoalField();
    </script>
</body>
</html>
